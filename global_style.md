# 全局代码风格规范

面向：曾做过游戏程序员、对 Cocos Creator 了解有限的团队成员。规则以 TypeScript + Cocos Creator 项目为默认环境。

## 基本约定
- 所有代码注释必须用中文，确保团队统一理解。
- 变量、函数、属性使用小驼峰命名；类、枚举、接口用大驼峰；常量用全大写加下划线。
- 禁止使用 `any`，保持强类型；必要时用精确联合或泛型。
- 默认开启严格模式：`strict`、`noImplicitAny`、`noUnusedLocals`、`noUnusedParameters`。
- 新文件统一 UTF-8，行尾使用 LF，缩进 2 空格。

## 目录与模块
- 脚本目录按层次拆分：`components/`（表现层）、`managers/` 或 `services/`（业务逻辑与状态）、`models/`（数据结构）、`utils/`（通用函数）。
- Prefab、脚本、资源同名同目录，便于查找与维护。
- 业务场景或功能模块使用子包/子目录，避免巨型目录。

## 注释与文档
- 复杂函数写明输入/输出、副作用、异常场景；公共 API 使用 JSDoc。
- TODO/FIXME 要带责任人或任务编号，避免悬空备注。
- 配置表和关键数据结构提供示例与字段说明。

## 命名与可读性
- 枚举值与事件名使用名词或动词短语且含语义：如 `PlayerState.Running`、`Event.GamePaused`。
- 资源、节点引用带语义后缀：`playerNode`、`hpBarNode`、`startButton`.
- 布尔变量用肯定式：`isDead`、`hasKey`、`shouldSync`。

## TypeScript 规则
- 所有异步函数使用 `async/await`，外层统一错误处理；不要裸 `then` 链。
- 严禁在 `update` 中创建对象或闭包；复用向量与数组。
- 导出 API 显式返回类型，内部私有函数可由推导，但复杂逻辑仍建议标注。
- 避免魔法数：使用常量或枚举集中管理。
- 事件名、网络消息类型集中常量化，杜绝散落字符串。

## Cocos Creator 特性
- 生命周期职责：`onLoad` 获取引用与初始化成员；`start` 执行首帧逻辑；`onEnable/onDisable` 绑定/解绑事件或计时器；`onDestroy` 释放资源。
- 资源加载统一走封装（如 `AssetLoader`/`ResourceManager`），内部处理超时、重试、引用计数；使用完 `decRef`/`release`。
- 高频节点使用对象池，取出与归还时重置状态，池子设置上限。
- UI 分层规范：背景/主体/弹窗/特效/指引；弹窗管理队列与遮罩。
- Label 使用合适的 Cache Mode；粒子、Spine、Mask 谨慎使用，注意合批影响。
- 计时统一由 `Timer/Task Manager` 管理，避免散落的 `scheduleOnce`。
- 场景/流程状态使用显式状态机，禁止隐式字符串状态。

## 日志与错误
- 使用封装的日志工具，分级（info/warn/error），可按平台/发布阶段开关。
- 关键流程加断言/防御性校验，开发版抛错，发布版降级处理并上报。

## 资源与配置
- 配置表加载后做 schema 校验；版本号与校验和用于热更新兼容。
- 场景切换前释放临时资源，长驻资源标注清晰；音频资源区别短音效与长音频。

## 安全与稳定性
- 不信任外部输入（存档、网络、配置），做边界与类型校验。
- 定时器、事件在组件禁用或销毁时必须解绑，避免泄漏与幽灵回调。

## 测试与验收
- 关键数值、状态机、服务层逻辑编写单测；至少覆盖主 happy path 与边界。
- 新功能自测清单至少包含：真机帧率、资源释放、异常恢复（断网/重连/切后台）。

## 提交与分支
- 提交前运行 `lint`/`format`/`test`；CI 不通过不得合并。
- 提交信息清晰说明变更范围与影响；禁止含糊信息（如 “fix bug”）。


